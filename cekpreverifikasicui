import tkinter as tk
from tkinter import ttk
from tkinter import messagebox
import psycopg2
import os
from pathlib import Path

def create_foto():
    conopen = psycopg2.connect(database=dbname,
		user=username,
		password=passwd,
		host=srver,
		port=port
		)
    curopen = conopen.cursor()
    st = "Select r1eiiy, rtrim(h1emid) as emid, r1pict from hrmasr "
    st += "left join hrmas1 on h1eiiy = r1eiiy "
    print(st)
    curopen.execute(st)
    resopen = curopen.fetchall()
    countopen = len(resopen)
    print(countopen)
    nama = ""
    for i in range(countopen):
        if nama != resopen[i][1]:
            no = 1
            nama = resopen[i][1]
        else :
            no += 1
        # os.path.
        if os.path.exists("foto/"+resopen[i][1]) == False:
            print(resopen[i][1])
            os.mkdir("foto/"+resopen[i][1])
        data = resopen[i][2]
        out = None
        out = open("foto/"+resopen[i][1]+"/"+resopen[i][1]+"_"+str(no)+".jpg", 'wb') 
        out.write(data) 
    conopen.close()

photo = None
dbname = "backupabsen"
username="postgres"
passwd="admin"
srver="localhost"
port="5432" 

lebar=0

image_id = None  # default value at start (to create global variable)


window = tk.Tk()
screnwidth = 600 
# window.winfo_screenwidth()
screnwidth2 = 0
screnheight = 480
# window.winfo_screenheight()-28
newx = 0
newy = 0
window.geometry(f"{screnwidth}x{screnheight}+{newx}+{newy}")
window.title('PRE VERIFIKASI ABSENSI')

tgh = (screnwidth//2) - 55
# window.wm_attributes('-type', 'splash')
# title_bar = tk.Frame(window, bg="gray", relief="groove", bd=2)
# title_bar.pack(fill=tk.X)

# title_label = tk.Label(title_bar, text="ABSENSI", font=fontttl, justify="center",  bg="gray", fg="white")
# title_label.pack(side=tk.LEFT, padx=tgh)

# close_button = tk.Button(title_bar, text="X", command=close_window, bg="gray", fg="white", relief="flat")
# close_button.pack(side=tk.RIGHT, padx=2)

# title_bar.bind('<B1-Motion>', move_window)
window.resizable(0,0)

for i in range(0,19):
    window.columnconfigure(i,weight=1,minsize=int(screnwidth/20))

for i in range(0,19):
    window.rowconfigure(i,minsize=int(screnheight/25))

btn = tk.Button(window, text="Prepared", command=create_foto)
btn.grid(row=1, column=1, columnspan=3, padx=15, sticky="w")

if os.path.exists("foto") == False:
    print("Tidak ada")
    os.mkdir("foto")

window.mainloop()
